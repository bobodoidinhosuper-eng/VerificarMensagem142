<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>TERMINAL DE AUTENTICAÇÃO 142</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/openpgp/5.11.0/openpgp.min.js"></script>
    <style>
        body { background-color: #050505; color: #00ff41; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        #terminal { width: 80%; max-width: 600px; background: #000; border: 1px solid #00ff41; padding: 20px; box-shadow: 0 0 20px rgba(0, 255, 65, 0.2); }
        textarea { width: 100%; height: 150px; background: #000; border: 1px solid #003300; color: #00ff41; padding: 10px; margin-top: 10px; outline: none; resize: none; }
        button { background: #00ff41; color: #000; border: none; padding: 15px; margin-top: 10px; cursor: pointer; font-weight: bold; width: 100%; text-transform: uppercase; }
        #status { margin-top: 20px; font-weight: bold; text-align: center; min-height: 45px; }
        .success { color: #00ff41; text-shadow: 0 0 10px #00ff41; }
        .error { color: #ff0000; text-shadow: 0 0 10px #ff0000; }
        .info { font-size: 0.8em; opacity: 0.7; margin-top: 15px; border-top: 1px solid #003300; padding-top: 10px; }
    </style>
</head>
<body>

<div id="terminal">
    <h2>ENIGMA 142</h2>
    <h3>[ TERMINAL DE AUTENTICAÇÃO ]</h3>
    <textarea id="pgpInput" placeholder="-----BEGIN PGP MESSAGE-----"></textarea>
    <button onclick="validar()">Verificar Assinatura</button>
    <div id="status"></div>
    <div class="info">
        Aviso: Sistema de integridade RSA-1024. A alteração de um único bit resultará em falha de autenticação.
    </div>
</div>

<script>
    async function validar() {
        const status = document.getElementById('status');
        const input = document.getElementById('pgpInput').value.trim();
        status.innerHTML = "> RASTREANDO ASSINATURA DIGITAL...";

        try {
            // Passo 1: Ler a mensagem
            const message = await openpgp.readMessage({ armoredMessage: input });
            
            // Passo 2: Extrair os IDs das chaves presentes na mensagem
            // Usamos uma técnica mais compatível para pegar o ID
            const packetList = message.packets;
            let foundMyKey = false;
            const myKeyID = "56ed576bd4df9ac0";

            // Varre os pacotes da mensagem em busca do ID da sua chave
            for (const packet of packetList) {
                if (packet.issuerKeyID) {
                    if (packet.issuerKeyID.toHex().toLowerCase() === myKeyID) {
                        foundMyKey = true;
                        break;
                    }
                }
                // Checa também pacotes de chave pública embutidos
                if (packet.keyID && packet.keyID.toHex().toLowerCase() === myKeyID) {
                    foundMyKey = true;
                    break;
                }
            }

            setTimeout(() => {
                if (foundMyKey) {
                    status.innerHTML = "<span class='success'>> SUCESSO: ORIGEM 142 CONFIRMADA! <br>> MENSAGEM INTEGRAL E AUTÊNTICA.</span>";
                } else {
                    status.innerHTML = "<span class='error'>>>> ERRO: CHAVE DESCONHECIDA <<< <br> ESTA MENSAGEM NÃO PERTENCE AO PROJETO 142.</span>";
                }
            }, 1000);

        } catch (e) {
            status.innerHTML = "<span class='error'>>>> ERRO: FORMATO INVÁLIDO <<< <br> O CÓDIGO INSERIDO NÃO É UM PACOTE PGP VÁLIDO.</span>";
        }
    }
</script>

</body>
</html>
